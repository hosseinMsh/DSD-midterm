

## 📄 راهنمای پروژه: تولید موج رمپ آنالوگ با PWM روی FPGA



### 🧠 خلاصه پروژه

هدف این پروژه تولید یک **موج رمپ خطی با فرکانس ۱kHz** به روش کاملاً دیجیتال است، بدون نیاز به DAC. با استفاده از **مدولاسیون پهنای پالس (PWM)** و عبور خروجی آن از یک **فیلتر RC ساده**، سیگنالی آنالوگ با فرم رمپ (مثلثی یک‌طرفه) تولید می‌شود.

---

## 🧩 منطق طراحی

### ✅ مرحله ۱: شمارنده رمپ

* شمارنده‌ای ۱۰ بیتی، از ۰ تا ۱۰۲۳ می‌شمارد و دوباره صفر می‌شود.
* هر تیک شمارنده باید به گونه‌ای زمان‌بندی شود که *کل دورهٔ شمارش ۱ms طول بکشد* (برای تولید موج ۱kHz).

### ✅ مرحله ۲: تولید PWM

* سیگنال PWM با مقایسه مقدار شمارنده رمپ (`ramp_val`) و یک شمارنده PWM داخلی تولید می‌شود.
* هر چه `ramp_val` بزرگ‌تر باشد، *پهنای پالس بیشتر* خواهد شد، یعنی سطح DC خروجی بالاتر می‌رود.

### ✅ مرحله ۳: فیلتر پایین‌گذر

* یک فیلتر ساده RC خروجی PWM را به سیگنال آنالوگ رمپ نرم تبدیل می‌کند.
* فرکانس قطع فیلتر به گونه‌ای انتخاب می‌شود که ریپل به حداقل برسد و شکل رمپ حفظ شود.

---

## 📂 ساختار فایل‌ها

| فایل             | توضیح                                            |
| ---------------- | ------------------------------------------------ |
| `ramp_pwm.v`     | ماژول اصلی شامل شمارنده رمپ و تولید‌کننده PWM    |
| `ramp_pwm_top.v` | لفاف بالا (Top-level wrapper) برای اتصال به FPGA |
| `tb_ramp_pwm.v`  | تست‌بنچ شبیه‌سازی برای ModelSim یا QuestaSim     |
| `README.md`      | راهنمای پروژه به زبان فارسی                      |
| `README_en.md`   | نسخه انگلیسی راهنما                              |

---

## ⚙️ پارامترهای طراحی

```verilog
parameter CLK_HZ    = 50_000_000; // فرکانس کلاک ورودی
parameter RAMP_FREQ = 1_000;      // فرکانس موج رمپ (1kHz)
parameter PWM_BITS  = 10;         // تعداد بیت PWM
```

### 🔸 محاسبات مهم

* تعداد گام‌های رمپ: 2^10 = 1024
* دوره زمانی هر گام:

  $$
  T_{\text{step}} = \frac{1}{f_{\text{ramp}} \times 1024} \approx 976 \text{ ns}
  $$
* بنابراین:

  $$
  \text{Divider} = \frac{50\,MHz}{1\,kHz \times 1024} \approx 48828
  $$
* فرکانس PWM:

  $$
  f_{\text{PWM}} = \frac{50\,MHz}{1024} \approx 48.8\,kHz
  $$

---

## 🧪 اجرای شبیه‌سازی

### ▶️ مراحل در ModelSim

1. فایل `tb_ramp_pwm.v` را به عنوان توپ‌لِول انتخاب کنید.
2. دستورات:

```tcl
vsim work.tb_ramp_pwm
add wave *
run 5ms
```

### 👁 مشاهدات:

* `ramp_val` از ۰ تا ۱۰۲۳ در هر ۱ms
* `pwm_out` موج PWM با پهنای پالس متغیر
* برای مشاهده رمپ نهایی، روی `pwm_out` راست‌کلیک > **Add > Integrate** (یکپارچه‌سازی)

---

## 🛠 پیاده‌سازی در Quartus و FPGA

### 🧩 مراحل:

1. انتخاب توپ‌لِول: `ramp_pwm_top`

2. تعیین پین‌ها در Pin Planner:

   | سیگنال    | پین مثال (برد DE2) |
   | --------- | ------------------ |
   | `clk_50`  | `CLOCK_50`         |
   | `rst_n`   | `KEY[0]`           |
   | `pwm_out` | `GPIO[0]`          |

3. برنامه‌ریزی FPGA

4. اتصال خروجی به فیلتر RC → مشاهده با اسیلسکوپ

---

## 🔌 طراحی فیلتر RC خروجی

| R      | C     | f<sub>c</sub> تقریبی |
| ------ | ----- | -------------------- |
| 3.3 kΩ | 10 nF | 4.8 kHz              |

* اگر ریپل زیاد بود:
  🔁 C را تا 22nF یا R را تا 10kΩ افزایش دهید

---

## 📈 مشاهدات روی برد واقعی

| کانال | سیگنال      | مشخصات                               |
| ----- | ----------- | ------------------------------------ |
| CH1   | PWM         | 0–3.3V، فرکانس ≈ 49kHz               |
| CH2   | خروجی فیلتر | موج رمپ صاف، از ۰ تا ۳.۳ ولت در ۱ ms |

---

## 🚀 توسعه‌های پیشنهادی

* تولید موج مثلثی: شمارنده up/down
* دقت بیشتر (۱۲ بیت)
* موج دلخواه با ROM LUT
* استفاده از sigma-delta modulation برای کاهش ریپل بیشتر

---

## 📃 مجوز

کد این پروژه تحت مجوز MIT آزاد است. استفاده برای اهداف آموزشی، تحقیقاتی یا صنعتی مجاز بوده و نیاز به ذکر منبع ندارد — ولی خوشحال می‌شویم اگر نام پروژه یا نویسنده را ذکر کنید.

---

## 🌍 نسخه انگلیسی

برای خواندن نسخه انگلیسی این راهنما، [اینجا کلیک کنید](README_en.md) یا فایل `README_en.md` را باز کنید.
